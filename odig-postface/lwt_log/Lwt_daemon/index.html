<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Lwt_daemon (lwt_log.Lwt_daemon)</title><link rel="stylesheet" href="../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.0.2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../index.html">lwt_log</a> &#x00BB; Lwt_daemon</nav><header class="odoc-preamble"><h1>Module <code><span>Lwt_daemon</span></code></h1><p>Daemon helpers</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec value" id="val-daemonize" class="anchored"><a href="#val-daemonize" class="anchor"></a><code><span><span class="keyword">val</span> daemonize : <span>?syslog:bool <span class="arrow">&#45;&gt;</span></span> <span>?stdin:<span>[ `Dev_null <span>| `Close</span> <span>| `Keep</span> ]</span> <span class="arrow">&#45;&gt;</span></span>
<span>?stdout:<span>[ `Dev_null <span>| `Close</span> <span>| `Keep</span> <span>| `Log_default</span> <span><span>| `Log</span> of <a href="../Lwt_log/index.html#type-logger">Lwt_log.logger</a></span> ]</span> <span class="arrow">&#45;&gt;</span></span>
<span>?stderr:<span>[ `Dev_null <span>| `Close</span> <span>| `Keep</span> <span>| `Log_default</span> <span><span>| `Log</span> of <a href="../Lwt_log/index.html#type-logger">Lwt_log.logger</a></span> ]</span> <span class="arrow">&#45;&gt;</span></span>
<span>?directory:string <span class="arrow">&#45;&gt;</span></span> <span>?umask:<span>[ `Keep <span><span>| `Set</span> of int</span> ]</span> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Put the current running process into daemon mode. I.e. it forks and exit the parent, detach it from its controlling terminal, and redict standard intputs/outputs..</p><p>Notes:</p><ul><li>you must be sure that there is no pending threads when calling this function, otherwise they may be canceled.</li></ul><p>If <code>syslog</code> is <code>true</code> (the default), then <a href="../Lwt_log/index.html#val-default"><code>Lwt_log.default</code></a> is set to <code>Lwt_log.syslog ~facility:`Daemon ()</code>, otherwise it is kept unchanged.</p><p><code>stdin</code> is one of:</p><ul><li><code>`Dev_null</code> which means that <code>Unix.stdin</code> is reopened as <code>/dev/null</code>, this is the default behavior</li><li><code>`Close</code> means that <code>Unix.stdin</code> is simply closed</li><li><code>`Keep</code> means that <code>Unix.stdin</code> is left unchanged</li></ul><p><code>stdout</code> and <code>stderr</code> control how the two associated file descriptors are redirected:</p><ul><li><code>`Dev_null</code> means that the output is redirected to <code>/dev/null</code></li><li><code>`Close</code> means that the file descriptor is closed</li><li><code>`Keep</code> means that it is left unchanged</li><li><code>`Log logger</code> means that the output is redirected to this logger</li><li><code>`Log_default</code> means that the output is redirected to the default logger</li></ul><p>Both <code>stdout</code> and <code>stderr</code> default to <code>`Log_default</code>.</p><p>Warning: do not redirect an output to a logger logging into this output. For example, this code will create an infinite loop:</p><pre><code>let logger = Lwt_log.channel ~close_mode:`Keep ~channel:Lwt_io.stderr () in
Lwt_daemon.daemonize ~syslog:false ~stderr:(`Log logger) ();
prerr_endline &quot;foo&quot;</code></pre><p>The current working directory is set to <code>directory</code>, which defaults to <code>&quot;/&quot;</code>.</p><p><code>umask</code> may be one of:</p><ul><li><code>`Keep</code> which means that the umask is left unchanged</li><li><code>`Set n</code> which means that the umask is set to <code>n</code></li></ul><p>It defaults to <code>`Set 0o022</code>.</p></div></div></div></body></html>